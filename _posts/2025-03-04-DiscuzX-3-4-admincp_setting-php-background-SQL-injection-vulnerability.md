# Discuz!X 3.4 admincp_setting.php Background SQL injection vulnerability

## Vulnerability Description

Not long ago, Discuz!X's background disclosed a sql injection vulnerability, thanks to the discovery and researchers of the vulnerability (sugar-free kn1f3).

## Affect Version

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">Discuz!X <3.4 R20191201 Version</span>

## Environment construction

Copy the files under the `upload` directory into the WWW directory under `phpstudy` and open the website and install it according to the steps.



![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/discuz-1.png)



![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/discuz-2.png)



## Vulnerability reappears



Come to the background page, add single quotes and grab the parameters at the `UCenter Application ID` position



![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/discuz-3.png)



I found an SQL statement error



![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/discuz-4.png)



Use error injection to get the version number



![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/discuz-5.png)



The parameter here is `settingnew[uc][appid]`



View the file `\source\admincp\admincp_setting.php`, and the input point was found on line 2677.



![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/discuz-6.png)



Find the SQL statement execution point based on the error statement, and line 206 in the file `uc_client\model\base.php`



![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/discuz-7.png)



Through the statement here, we can see that we can use the `union injection` method to write malicious files (`secure_file_priv cannot be Null`)



![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/discuz-8.png)



```plain
1' union select "<?php phpinfo();?>"  into outfile 'D:/test.php';--+
```



Other methods can also be used