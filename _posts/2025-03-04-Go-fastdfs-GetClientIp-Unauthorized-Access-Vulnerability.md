# Go-fastdfs GetClientIp Unauthorized Access Vulnerability

## Vulnerability Description

The Go-fastdfs GetClientIp method has an XFF header bypass vulnerability. Through the vulnerability, an attacker can call the interface without authorization to obtain sensitive information such as configuration files.

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">Go-fastdfs  </span>

## Network surveying and mapping

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">"go-fastdfs" </span>

## Vulnerability reappears

Main page

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680944897657-800f832f-0834-4ac3-bf45-bd1f208326a4-20230415101718568.png)

Call the read configuration interface, return ip not allowed to access

```plain
/group1/reload?action=get
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680947487576-fe109286-5b54-4719-8a6c-97d0bab0195e.png)

Tracking error message code

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680947601766-4ef44fa9-6daf-429f-b744-b8c9816f705f.png)

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680947698319-f074adce-1bb0-4d6c-892f-75a9e97499fc.png)

Follow the GetClientIp method, here we will get the value from X-Forwarded-For and other parameters

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680947727700-28338520-a44b-4dc0-aaea-d8472455cae9.png)

Go back to the starting point of the call, the verification method is to call the IsPeer parameter

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680956299322-f59b1eb3-ec47-4c26-8e65-ea899bb4fce1.png)

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680956399670-9e08c9e2-187c-48ad-9cd9-2fafd245061d.png)

Here is mainly to verify whether the obtained value is the AdminIps in the configuration

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680956485885-f8063692-42e2-4287-80fa-9513fcac3d99.png)

In the configuration file cfg.json, admin_ips defaults to 127.0.0.1 (can be blasted)

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680956563169-0313e611-f10e-4104-9ce2-893ed316ebc9.png)

Therefore, by setting X-Forwarded-For, you can bypass interface call restrictions, perform operations such as modifying configuration files, and verifying the POC

```plain
/group1/reload?action=get

X-Forwarded-For: 127.0.0.1
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1680956654166-f02b3f8a-e474-4749-8290-7e6890d937dd.png)