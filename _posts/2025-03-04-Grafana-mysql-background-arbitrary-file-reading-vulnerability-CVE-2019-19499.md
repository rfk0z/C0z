# Grafana mysql background arbitrary file reading vulnerability CVE-2019-19499

## Vulnerability Description

Grafana is an open source application for analytics, monitoring, and data visualization. 

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">Grafana < 6.4.4</span>

## Environment construction

```sh
docker pull grafana/grafana:6.4.3 
docker run -d --name=grafana -p 3000:3000 grafana/grafana:6.4.3 
```

## Vulnerability reappears

Log in to the background admin/admin, add data source Mysql

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1651028841683-f01b58e6-4274-4074-82b6-0b4f05c87475.png)

[Reference for fixing vulnerabilities](https://github.com/grafana/grafana/pull/20192/files)

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1651028825347-5151f68b-125c-4334-830e-4b4282df4b09.png)

The fix is ​​the user-controllable part of the database database name. Since the allowAllFiles=true parameter can disable protection of LOCAL INFILE requests, you can obtain any file in the server through previous vulnerabilities regarding any Mysql file reading.

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1651029262386-e799b54d-5d9f-4d63-8a95-e74b729ba966.png)

Create another malicious Mysql: [https://github.com/allyshka/Rogue-MySql-Server](https://github.com/allyshka/Rogue-MySql-Server)

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1651029326354-a2d6830f-8087-4c6f-a295-e94964b8877e.png)

Execute Save to read the file

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1651029367812-9d8bcfc1-201d-4343-a1ca-fd97686cd3b9.png)